import 'package:flutter/material.dart';
import 'package:flutter/services.dart';

class PentestGuideScreen extends StatelessWidget {
  const PentestGuideScreen({super.key});

  final String targetIp = '115.133.118.216';
  final String clientName = 'Total SE Solutions Sdn Bhd (TSE)';

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Pentest Methodology'),
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
      ),
      body: ListView(
        padding: const EdgeInsets.all(16.0),
        children: [
          _buildHeader(),
          const Divider(height: 32),
          _buildSectionTitle('1. Pre-Engagement & Reconnaissance'),
          _buildStep(
            context,
            '3.1 Host Availability Check',
            'Check if the host is online.',
            'ping -c 4 $targetIp',
          ),
          _buildStep(
            context,
            '3.2 WHOIS Lookup',
            'Identify IP ownership and details.',
            'whois $targetIp',
          ),
          _buildStep(
            context,
            '3.3 Reverse DNS Lookup',
            'Check for associated domain names.',
            'nslookup $targetIp',
          ),
          const SizedBox(height: 16),
          _buildSectionTitle('2. Scanning & Enumeration'),
          _buildStep(
            context,
            '4.1 Quick Port Scan',
            'Scan top 100 common ports.',
            'nmap -F $targetIp',
          ),
          _buildStep(
            context,
            '4.2 Full TCP Port Scan',
            'Scan all 65535 ports.',
            'nmap -p- -T4 $targetIp',
          ),
          _buildStep(
            context,
            '4.3 Service Version Detection',
            'Detect service versions on open ports.',
            'nmap -sV $targetIp',
          ),
          _buildStep(
            context,
            '4.4 OS Detection',
            'Attempt to identify the operating system.',
            'sudo nmap -O $targetIp',
          ),
          _buildStep(
            context,
            '4.5 Script Scan',
            'Run default nmap scripts.',
            'nmap -sC $targetIp',
          ),
          const SizedBox(height: 16),
          _buildSectionTitle('3. Vulnerability Assessment'),
          _buildStep(
            context,
            '5.1 Nmap Vulnerability Scan',
            'Scan for known vulnerabilities using NSE.',
            'nmap --script vuln $targetIp',
          ),
          _buildStep(
            context,
            '5.2 Web Checks',
            'Scan web server for vulnerabilities (if port 80/443 open).',
            'nikto -h http://$targetIp',
          ),
          _buildStep(
            context,
            '5.3 SSL/TLS Check',
            'Analyze SSL/TLS configuration.',
            'sslscan $targetIp',
          ),
          const SizedBox(height: 16),
          _buildSectionTitle('4. Post-Test'),
          _buildStep(
            context,
            '12. Retest',
            'Verify fixes after remediation.',
            'nmap -sV $targetIp',
          ),
        ],
      ),
    );
  }

  Widget _buildHeader() {
    return Card(
      color: Colors.blueGrey.shade50,
      child: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text('Client: $clientName', style: const TextStyle(fontWeight: FontWeight.bold)),
            const SizedBox(height: 8),
            Text('Target IP: $targetIp', style: const TextStyle(fontSize: 18, fontWeight: FontWeight.w900, color: Colors.blue)),
            const SizedBox(height: 8),
            const Text('Assessment Type: External Black-Box'),
          ],
        ),
      ),
    );
  }

  Widget _buildSectionTitle(String title) {
    return Padding(
      padding: const EdgeInsets.only(bottom: 12.0),
      child: Text(
        title,
        style: const TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
      ),
    );
  }

  Widget _buildStep(BuildContext context, String title, String description, String command) {
    return Card(
      margin: const EdgeInsets.only(bottom: 12),
      elevation: 2,
      child: ExpansionTile(
        title: Text(title, style: const TextStyle(fontWeight: FontWeight.w600)),
        subtitle: Text(description, style: TextStyle(color: Colors.grey.shade600, fontSize: 12)),
        children: [
          Container(
            width: double.infinity,
            padding: const EdgeInsets.all(12),
            color: Colors.black87,
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                SelectableText(
                  command,
                  style: const TextStyle(color: Colors.greenAccent, fontFamily: 'Courier', fontWeight: FontWeight.bold),
                ),
                const SizedBox(height: 8),
                Align(
                  alignment: Alignment.centerRight,
                  child: TextButton.icon(
                    onPressed: () {
                      Clipboard.setData(ClipboardData(text: command));
                      ScaffoldMessenger.of(context).showSnackBar(
                        const SnackBar(content: Text('Command copied to clipboard')),
                      );
                    },
                    icon: const Icon(Icons.copy, size: 16, color: Colors.white70),
                    label: const Text('Copy', style: TextStyle(color: Colors.white70)),
                  ),
                )
              ],
            ),
          ),
        ],
      ),
    );
  }
}
